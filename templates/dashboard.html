<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Electrical Construction Project Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/dashboard.css') }}" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="fas fa-bolt me-2"></i>
                Electrical PM
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="/"><i class="fas fa-tachometer-alt me-1"></i>Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#projects" onclick="showTab('projects')"><i class="fas fa-project-diagram me-1"></i>Projects</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#calculations" onclick="showTab('calculations')"><i class="fas fa-calculator me-1"></i>Calculations</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#materials" onclick="showTab('materials')"><i class="fas fa-cogs me-1"></i>Materials</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <button class="btn btn-outline-light" onclick="openCreateProjectModal()">
                            <i class="fas fa-plus me-1"></i>New Project
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <!-- Dashboard Overview -->
        <div id="dashboard-content">
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="text-dark">Project Management Dashboard</h2>
                    <p class="text-muted">AI-Powered Electrical Construction Management System</p>
                </div>
            </div>

            <!-- KPI Cards & Charts -->
            <div class="row mb-4">
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-primary shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                        Active Projects
                                    </div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="active-projects-count">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-project-diagram fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-success shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                        Total Budget
                                    </div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-budget">$0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-info shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                        Avg Progress
                                    </div>
                                    <div class="row no-gutters align-items-center">
                                        <div class="col-auto">
                                            <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800" id="avg-progress">0%</div>
                                        </div>
                                        <div class="col">
                                            <div class="progress progress-sm mr-2">
                                                <div class="progress-bar bg-info" role="progressbar" id="progress-bar" style="width: 0%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-warning shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                        Cost Variance
                                    </div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="cost-variance">0%</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-chart-line fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">Project Progress Chart</div>
                        <div class="card-body">
                            <canvas id="progressChart" height="120"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">Budget vs Actual Cost</div>
                        <div class="card-body">
                            <canvas id="budgetChart" height="120"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Project Table -->
            <div class="row">
                <div class="col-xl-8 col-lg-7">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                            <h6 class="m-0 font-weight-bold text-primary">Active Projects</h6>
                            <div class="dropdown no-arrow">
                                <a class="dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                </a>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered" id="projects-table">
                                    <thead>
                                        <tr>
                                            <th>Project Name</th>
                                            <th>Status</th>
                                            <th>Progress</th>
                                            <th>Budget</th>
                                            <th>Actual Cost</th>
                                            <th>Timeline</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="projects-tbody">
                                        <!-- Projects will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="col-xl-4 col-lg-5">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Recent Activity</h6>
                        </div>
                        <div class="card-body">
                            <div class="activity-feed">
                                <div class="activity-item">
                                    <div class="activity-icon bg-primary">
                                        <i class="fas fa-plus text-white"></i>
                                    </div>
                                    <div class="activity-content">
                                        <h6>New Project Created</h6>
                                        <p class="text-muted">Industrial Complex - Phase 2</p>
                                        <small class="text-muted">2 hours ago</small>
                                    </div>
                                </div>
                                <div class="activity-item">
                                    <div class="activity-icon bg-success">
                                        <i class="fas fa-calculator text-white"></i>
                                    </div>
                                    <div class="activity-content">
                                        <h6>Electrical Calculation Completed</h6>
                                        <p class="text-muted">Load flow analysis for Main Panel A</p>
                                        <small class="text-muted">5 hours ago</small>
                                    </div>
                                </div>
                                <div class="activity-item">
                                    <div class="activity-icon bg-info">
                                        <i class="fas fa-cogs text-white"></i>
                                    </div>
                                    <div class="activity-content">
                                        <h6>Material Pricing Updated</h6>
                                        <p class="text-muted">Real-time copper prices refreshed</p>
                                        <small class="text-muted">1 day ago</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Projects Tab -->
        <div id="projects-content" style="display: none;">
            <div class="row mb-3">
                <div class="col-12 d-flex justify-content-between align-items-center">
                    <h3>Project Management</h3>
                    <button class="btn btn-primary" onclick="openCreateProjectModal()">
                        <i class="fas fa-plus me-1"></i> New Project
                    </button>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">Projects List</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered" id="projects-list-table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Status</th>
                                            <th>Progress</th>
                                            <th>Budget</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="projects-list-tbody">
                                        <!-- Projects will be loaded here by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Project Detail Modal -->
        <div class="modal fade" id="projectDetailModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Project Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body" id="project-detail-body">
                        <!-- Details will be loaded by JS -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-danger" id="delete-project-btn">Delete Project</button>
                        <button type="button" class="btn btn-primary" id="edit-project-btn">Edit Project</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calculations Tab -->
        <div id="calculations-content" style="display: none;">
            <div class="row mb-3">
                <div class="col-12">
                    <h3>Electrical Calculations</h3>
                    <p class="text-muted">Perform load flow, voltage drop, fault current, and cable sizing calculations</p>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-header">Load Flow Analysis</div>
                        <div class="card-body">
                            <form id="loadFlowForm">
                                <div class="mb-3">
                                    <label>Voltage (V)</label>
                                    <input type="number" class="form-control" name="voltage" required>
                                </div>
                                <div class="mb-3">
                                    <label>Current (A)</label>
                                    <input type="number" class="form-control" name="current" required>
                                </div>
                                <div class="mb-3">
                                    <label>Power Factor</label>
                                    <input type="number" step="0.01" class="form-control" name="power_factor" required>
                                </div>
                                <div class="mb-3">
                                    <label>Distance (m)</label>
                                    <input type="number" class="form-control" name="distance" required>
                                </div>
                                <button type="button" class="btn btn-primary" onclick="runLoadFlowCalculation()">Calculate</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-header">Voltage Drop Calculation</div>
                        <div class="card-body">
                            <form id="voltageDropForm">
                                <div class="mb-3">
                                    <label>Voltage (V)</label>
                                    <input type="number" class="form-control" name="voltage" required>
                                </div>
                                <div class="mb-3">
                                    <label>Current (A)</label>
                                    <input type="number" class="form-control" name="current" required>
                                </div>
                                <div class="mb-3">
                                    <label>Distance (m)</label>
                                    <input type="number" class="form-control" name="distance" required>
                                </div>
                                <button type="button" class="btn btn-primary" onclick="runVoltageDropCalculation()">Calculate</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-header">Fault Current Analysis</div>
                        <div class="card-body">
                            <form id="faultCurrentForm">
                                <div class="mb-3">
                                    <label>Voltage (V)</label>
                                    <input type="number" class="form-control" name="voltage" required>
                                </div>
                                <div class="mb-3">
                                    <label>Impedance (Î©)</label>
                                    <input type="number" step="0.01" class="form-control" name="impedance" required>
                                </div>
                                <button type="button" class="btn btn-primary" onclick="runFaultCurrentCalculation()">Calculate</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-header">Cable Sizing</div>
                        <div class="card-body">
                            <form id="cableSizingForm">
                                <div class="mb-3">
                                    <label>Current (A)</label>
                                    <input type="number" class="form-control" name="current" required>
                                </div>
                                <div class="mb-3">
                                    <label>Length (m)</label>
                                    <input type="number" class="form-control" name="length" required>
                                </div>
                                <div class="mb-3">
                                    <label>Voltage (V)</label>
                                    <input type="number" class="form-control" name="voltage" required>
                                </div>
                                <button type="button" class="btn btn-primary" onclick="runCableSizingCalculation()">Calculate</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div id="calculationResults"></div>
                </div>
            </div>
        </div>

        <!-- Materials Tab -->
        <div id="materials-content" style="display: none;">
            <div class="row mb-3">
                <div class="col-12">
                    <h3>Material Management</h3>
                    <p class="text-muted">Real-time material pricing, supplier comparison, and inventory tracking</p>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-header">Supplier Price Comparison</div>
                        <div class="card-body">
                            <form id="supplierCompareForm">
                                <div class="mb-3">
                                    <label>Material Type</label>
                                    <select class="form-control" name="material_type">
                                        <option value="copper">Copper Cable</option>
                                        <option value="breaker">Circuit Breaker</option>
                                        <option value="panel">Panelboard</option>
                                        <option value="transformer">Transformer</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label>Quantity</label>
                                    <input type="number" class="form-control" name="quantity" required>
                                </div>
                                <button type="button" class="btn btn-primary" onclick="runSupplierComparison()">Compare Prices</button>
                            </form>
                            <div id="supplierComparisonResults" class="mt-3"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-header">Inventory Tracking</div>
                        <div class="card-body">
                            <form id="inventoryForm">
                                <div class="mb-3">
                                    <label>Material Name</label>
                                    <input type="text" class="form-control" name="material_name" required>
                                </div>
                                <div class="mb-3">
                                    <label>Stock Level</label>
                                    <input type="number" class="form-control" name="stock_level" required>
                                </div>
                                <div class="mb-3">
                                    <label>Lead Time (days)</label>
                                    <input type="number" class="form-control" name="lead_time" required>
                                </div>
                                <button type="button" class="btn btn-success" onclick="addInventoryItem()">Add to Inventory</button>
                            </form>
                            <div id="inventoryList" class="mt-3"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create/Edit Project Modal -->
    <div class="modal fade" id="createProjectModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="projectModalTitle">Create New Project</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createProjectForm">
                        <input type="hidden" name="project_id" id="project_id">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Project Name *</label>
                                    <input type="text" class="form-control" name="name" id="project_name" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Project Type</label>
                                    <select class="form-control" name="type" id="project_type">
                                        <option value="commercial">Commercial</option>
                                        <option value="industrial">Industrial</option>
                                        <option value="residential">Residential</option>
                                        <option value="utility_scale">Utility Scale</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" name="description" id="project_description" rows="3"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Start Date</label>
                                    <input type="date" class="form-control" name="start_date" id="project_start_date">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">End Date</label>
                                    <input type="date" class="form-control" name="end_date" id="project_end_date">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Budget ($)</label>
                                    <input type="number" class="form-control" name="budget" id="project_budget" step="0.01">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Voltage Level</label>
                                    <select class="form-control" name="voltage_level" id="project_voltage_level">
                                        <option value="120V">120V</option>
                                        <option value="208V">208V</option>
                                        <option value="240V">240V</option>
                                        <option value="480V">480V</option>
                                        <option value="2400V">2400V</option>
                                        <option value="13800V">13.8kV</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveProjectBtn">Save Project</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>